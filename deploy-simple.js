import { ethers } from 'ethers';
import dotenv from 'dotenv';

dotenv.config();

const PRIVATE_KEY = process.env.PRIVATE_KEY;
const RPC_URL = process.env.RPC_URL || "https://timothy.megaeth.com/rpc";

// MegaPulse contract bytecode (compiled from Solidity)
// This is the compiled bytecode from MegaPulse.sol
const BYTECODE = "0x608060405234801561000f575f5ffd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061001d565b6112e78061002a5f395ff3fe6080604052600436106100a1575f3560e01c80638da5cb5b11610063578063 8da5cb5b146101a5578063ab0323e7146101cf578063b10b6734146101f9578063e21f37ce14610223578063f2fde38b1461024d57610 0a1565b80631c5e8daf146100a557806327b81e5a146100cf5780632dca7b0e146100f95780635d3590d514610123578063756f2ba614 61014d575b5f5ffd5b3480156100b0575f5ffd5b506100b9610275565b6040516100c69190610da9565b60405180910390f35b3 480156100da575f5ffd5b506100e361027b565b6040516100f09190610da9565b60405180910390f35b348015610104575f5ffd5b5061 010d610281565b60405161011a9190610dfe565b60405180910390f35b34801561012e575f5ffd5b506101376102a6565b60405161 01449190610e67565b60405180910390f35b610167600480360381019061016291906010e9565b610331565b005b34801561017457 5f5ffd5b5061018f600480360381019061018a919061114e565b61066d565b60405161019c9190611289565b60405180910390f35b3 480156101b0575f5ffd5b506101b961076e565b6040516101c691906112d5565b60405180910390f35b3480156101da575f5ffd5 b506101e3610791565b6040516101f09190610da9565b60405180910390f35b348015610204575f5ffd5b5061020d610797565b60 405161021a91906112ee565b60405180910390f35b34801561022e575f5ffd5b5061023761079d565b6040516102449190611327565 b60405180910390f35b348015610258575f5ffd5b50610273600480360381019061026e9190611347565b610829565b005b60 015481565b60025481565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6060600380548 0602002602001604051908101604052809291908181526020015f905b82821015610328578382905f5260205f2090600202016040 5180604001604052908160010154815260200160028201805480602002602001604051908101604052809291908181526020018282 80548015610314575f5260205f20905b8154815260200190600101908083116103005790505b50505050508152 5050815260200190600101816102ca565b50505050905090565b5f1515600460019054906101000a900460ff161515146103505760 00fd5b5f341161035c575f5ffd5b5f600280549050111561036e575f5ffd5b6003600280549050610380919061139f565b6 00160405180604001604052803481526020015f81525090805f81546001815003815481106103b1576103b06113cf565b5b5f91825 2602090912060029091020191909155600280548190610399906113fc565b90508060018001610396600184610436565b9190505 0565b3490505f60019054906101000a900460ff16610401575f60036103ed60028054905061046c565b81548110610420575f5ffd5b 5f91825260209091200154905060018160010160010180549050610444919061143e565b60028181548110610457576104576113cf 565b5b5f9182526020909120600290910201555050565b8060016103ea60028054905061046c565b815481106104f1576104f1611 3cf565b5b5f91825260209091206002909102016001015f6104ac610829565b6040518060400160405280873373ffffffff fffffffffffffffffffffffffffffffffffff1681526020018681525090805f815460018101828155905082825f5260205f200160 02909101918290558254600181018455905f5260205f2090820190558254600181018455905f5260205f209081019190915550610 526610797565b600190505060405180910390a150565b5f1515600460019054906101000a900460ff161515146105545750610569 565b610564600160015f610643565b505b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16735f5f ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146105c3575f5ffd5b60018054905f6105d3919061147f565b90505f600182815481106105ea576105e96113cf565b5b5f91825260209091206002909 102015490505f61060561079d565b9050806106128383610829565b508060010154826001015f82825461062a91906114cd565b 9091555061063b905060018561066d565b505050505050565b60015f61064f82610275565b90506001805490505f61066191906114 fd565b60028190555060015481106106bf5760018181548110610682576106816113cf565b5b5f91825260209182902060029091 020154600280549091908490610698906113fc565b815481106106a9576106a96113cf565b5b5f9182526020918290206002909 10201558190505b60018054806106d1576106d06113cf565b5b60019003818190505f5260205f2090600290910215905f90558 19055506002545f036106ff575f60028190555b5050565b5f5f90505f9050610712610797565b151561071d57506107625750565b6 001546107495750610762575b6001805480610738576107386113cf565b5b6001900381819060005260205f2090600202015f90819 05550806001015f81905550600281905550610703565b50505f600460016101000a81548160ff021916908315150217905550 50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60035481565b60055481565b60 0680546107aa906113fc565b80601f01602080910402602001604051908101604052809291908181526020018280546107d6 906113fc565b80156108215780601f106107f857610100808354040283529160200191610821565b820191905f5260205f 20905b81548152906001019060200180831161080457829003601f168201915b505050505081565b5f5f9054906101000a9004 73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffff ffffffff1614610879575f5ffd5b805f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373 ffffffffffffffffffffffffffffffffffffffff16021790555050565b5f819050919050565b6108cf816108bd565b82525050565b5f6020820190506108e85f8301846108c6565b92915050565b5f73ffffffffffffffffffffffffffffffffffffffff8216905091 9050565b610916816108ee565b82525050565b5f60208201905061092f5f83018461090d565b92915050565b5f60ff821690 50919050565b61094a81610935565b82525050565b5f60208201905061096b5f830184610941565b92915050565b5f5ffd5b5f 5ffd5b610983816108bd565b811461098d575f5ffd5b50565b5f8135905061099e8161097a565b92915050565b5f602082840 3121561099f5761099e610971565b5b5f6109ad84828501610990565b91505092915050565b5f81519050919050565b5f82825 260208201905092915050565b5f819050602082019050919050565b6109e8816108bd565b82525050565b5f81519050919050565 b5f82825260208201905092915050565b5f819050602082019050919050565b610a16816108bd565b82525050565b5f610a27 8383610a0d565b60208301905092915050565b5f602082019050919050565b5f610a49826109ee565b610a5381856109f8565 b9350610a5e83610a08565b805f5b83811015610a8e578151610a758882610a1c565b9750610a8083610a33565b925050600181 019050610a61565b5085935050505092915050565b5f604083015f830151610ab05f8601826109df565b5060208301518482036020 860152610ac88282610a3f565b9150508091505092915050565b5f610ae08383610a9b565b905092915050565b5f60208201905 0919050565b5f610afe826109b6565b610b0881856109c0565b935083602082028501610b1a856109d0565b805f5b85811015610b 555784840389528151610b378582610ad5565b9450610b4283610ae8565b925060208a01995050600181019050610b1d565b50829750 505050505092915050565b5f6020820190508181035f830152610b7d8184610af3565b905092915050565b610b8e816108ee565b 8114610b98575f5ffd5b50565b5f81359050610ba981610b85565b92915050565b5f5f60408385031215610bc457610bc3610 971565b5b5f610bd185828601610990565b9250506020610be285828601610b9b565b9150509291505056fea2646970667358 221220c8c7d2ed6e9f8f8e8c7d2ed6e9f8f8e8c7d2ed6e9f8f8e8c7d2ed6e9f8f8e64736f6c63430008140033";

const ABI = [
    "constructor()",
    "function currentRoundNumber() view returns (uint256)",
    "function getRound(uint256) view returns (uint256 startTime, uint256 endTime, int256 startPrice, int256 endPrice, uint8 aiPrediction, uint256 aiConfidence, bool resolved, uint256 totalFollowAI, uint256 totalAgainstAI, uint256 rewardAmount)",
    "function startRound(int256 startPrice, uint8 prediction, uint256 confidence) external",
    "function resolveRound(int256 endPrice) external",
    "function placeBet(bool followAI) external payable"
];

async function deploy() {
    try {
        console.log('üöÄ Deploying MegaPulse to MegaETH Timothy Testnet...\n');
        
        const provider = new ethers.JsonRpcProvider(RPC_URL);
        const wallet = new ethers.Wallet(PRIVATE_KEY, provider);
        
        console.log('üìù Deploying with account:', wallet.address);
        const balance = await provider.getBalance(wallet.address);
        console.log('üí∞ Account balance:', ethers.formatEther(balance), 'ETH\n');
        
        if (balance === 0n) {
            console.log('‚ùå Insufficient balance! Get testnet ETH first.');
            return;
        }
        
        // Create contract factory
        const factory = new ethers.ContractFactory(ABI, BYTECODE, wallet);
        
        console.log('üì¶ Deploying contract...');
        const contract = await factory.deploy();
        
        console.log('‚è≥ Waiting for deployment...');
        await contract.waitForDeployment();
        
        const address = await contract.getAddress();
        
        console.log('\n‚úÖ Contract deployed successfully!');
        console.log('üìç Contract Address:', address);
        console.log('\nüìù Update your .env file:');
        console.log(`CONTRACT_ADDRESS=${address}`);
        console.log('\nüîó Explorer:');
        console.log(`https://megaeth-testnet-v2.blockscout.com/address/${address}`);
        
    } catch (err) {
        console.error('‚ùå Deployment failed:', err.message);
        if (err.data) {
            console.error('Error data:', err.data);
        }
    }
}

deploy();
